# Tap(リポジトリ)の追加
- name: Add Homebrew Taps
  community.general.homebrew_tap:
    name: FelixKratz/formulae
    state: present

- name: UpdateHomebrew
  community.general.homebrew:
    update_homebrew: yes

# CUIのインストール
- name: Install Homebrew Packages
  community.general.homebrew:
    name: "{{ item }}"
    state: present
  loop:
    - navi
    - fzf
    - cmatrix
    - cava
    - fastfetch
    - figlet
    - lolcat
    - tty-clock
    - yazi
    - ffmpegthumbnailer
    - unar
    - jq
    - poppler
    - fd
    - ripgrep
    - zoxide
    - sketchybar
    - lua
    - switchaudio-osx
    - nowplaying-cli
    - pnpm
    - lazygit
    - gh
    - sheldon
    - xwmx/taps/nb
    - node
    - nvim

# Caskのインストール
- name: Install Homebrew Casks
  community.general.homebrew_cask:
    name: "{{ item }}"
    state: present
  loop:
    - ghostty
    - raycast
    - nikitabobko/tap/aerospace
    - alt-tab
    # 手動で入れる必要ありかも
    - sf-symbols
    - font-hack-nerd-font
    - font-sf-pro
    - font-sf-mono

- name: Install tree-sitter-cli globally via npm
  community.general.npm:
    name: tree-sitter-cli
    global: yes
    state: latest
  become: true

# SketchyBar 関連の処理
# SbarLua のインストール
# - name: Remove existing SbarLua directory
#   file:
#     path: /tmp/SbarLua
#     state: absent
#   become: true
#
# - name: Clone SbarLua
#   git:
#     repo: https://github.com/FelixKratz/SbarLua.git
#     dest: /tmp/SbarLua
#     depth: 1
#     force: true
#
# - name: Compile and Install SbarLua
#   shell: |
#     cd /tmp/SbarLua
#     make install
#   args:
#     creates: /opt/homebrew/lib/sketchybar.so
#   become: true
#
# icon_update.shを実行
# - name: Run sketchybar icon updater
#   shell: |
#     chmod +x {{ ansible_facts.env.HOME }}/dotfiles/sketchybar/icon_updater.sh
#     {{ ansible_facts.env.HOME }}/dotfiles/sketchybar/icon_updater.sh

# SketchyBar サービスの起動
- name: Restart SketchyBar service
  shell: brew services stop sketchybar || true && brew services start sketchybar
